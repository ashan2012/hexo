---
title: 工作笔记之一：猜你喜欢模块
date: 2017-01-13
layout: post
permalink: /blog/2017/01/13/guesswantquery.html
categories: 工作笔记
tags: [推荐,短文本,去重,反垃圾]
excerpt: "记录在猜你想搜模块的心得"
---

##猜你喜欢

推荐语料为搜索query，目标为提升搜索量，提升用户搜索体验，分解一下为推出的query为相关和惊喜度，+热门
整体方案如下：
![猜你喜欢数据流程图](http://ashan2012.github.io/images/guesswantquery/structure.png)

###召回阶段
----------------------------------------
__1. 种子集合__
    
  - 搜索的query，按照搜索的频度可以分为经常搜索的和最近搜索的query
  - 用户的画像(可以根据用户的其他行为),最好对于用户总结关键词，tag，类别等分层次的行为

__2. 扩展候选集合__
   
   - 扩展可以根据item-base,query之间的关系扩展
   - 扩展可以根据用户的关键词图谱召回相关query
   - 扩展可以通过tag和类别召回惊喜度较高的query
   - 有些词语不进行扩展，专门的词库:天气，彩票，双色球等等

__3.低质量过滤__

   - 第一层为query的UV过滤
     - uv过滤根据query的搜索UV，删掉搜索人数比较少的query，砍掉80%的query
   - 第二层基于词表的过滤   
     - **全量匹配**：全量是硬匹配，一些事件，人物，垃圾词等等。“蛤蛤怒斥香港女记者”，“身度完整版”，“6080神马影院”，“东条希本子”
     - **部分匹配**:一些垃圾词，色情，隐私等
     - **乱码**：可能是韩文，日文，搜索日志中的乱码。
     - **政治敏感词**:政治敏感词库不能出
     - **竞品词**：不让出的
   - 第二层为基于libshorttxt的二分类模型
     - 以字为特征，构造正例和负例。其中正例为热门中的正常query。负例为匹配出来的query，两边都是1万
 
__4.去重__
   
  由于用户本身搜索的query表明的意思比较集中，则通过扩展构造的query集合大量重复的query，这种大量重复的query影响了用户体验。所以需要去重逻辑，保证推出的query的多样性
  
  - 第一层去重逻辑为长词的归一化

    归一化的目的是合并一些表明一个意思的词语到一个意思，类似于query聚类，然后去类的中心点。聚类通过query的点击url的关系来实现，实现方法是将点击一个url（这个url必须是落地页面）的query中找到一个keyquery，keyquery的计算方法是用query的点击次数/query的长度，然后将二者的关系作为key,value,相同的key选value最大的为keyquery
    
    - 归一化比较规范的:
      - 00后时髦小女生图片  REPLACE 00后小美女/2.4
      - 贷视频流出 REPLACE 裸贷肉偿视频遭疯传/8.5 不同地方热点事件归一化到最规范的说法
      - 12360下载官方下载手机版 REPLACE 12360下载/175.111111111
      - qq飞车星光秀场怎么进去  REPLACE 星光秀场/114.75
      - 奥运会项目有哪些    REPLACE 奥运会/55.6
      - 芭比公主之美人鱼的故事  REPLACE 美人鱼故事/4.6
      - 八零后副厅  REPLACE 王玺玮的父亲/4.0
      - 保卫萝卜2攻略108攻略水晶萝卜头  REPLACE 保卫萝卜108/3.63636363636
      - 保卫部落3d策略塔防  REPLACE 保卫部落/4.0
    - 也有代表并不正确：
      - 07excel箭头在哪 REPLACE excel绘图工具在哪/3.64705882353
      - 09年君威    REPLACE 09年君威二手车价格/478.75
      - 0p手机剩余电量怎么设置  REPLACE 小米手机电量百分比/7.88888888889
  - 第二层为一些case的规则:
    - 比如说对小说多个章节，电影多个系列的合并，通过正则表达式[\d]+?字，部，章等
      - 三妹53集        NEW:三妹
      - 小雄的故事1864章        NEW:小雄的故事
    - 根据一些词语切割，取前面的意思：
      - OLD:0852蟹总完整版     NEW:0852蟹总
      - OLD:2345影视大全       NEW:2345影视
      - gta5秘籍大全       NEW:gta5秘籍
      - 傲世掌控txt下载    NEW:傲世掌控
      - 爱莎美瞳官网       NEW:爱莎美瞳
      - 霸皇下载   NEW:霸皇
    - 针对小说漫画，针对用户构成，对小说，漫画单独处理，根据小说的名字，漫画的名字，每个中最多出两个:
      - 择天记电视剧-择天记
      - 偷香高手||5||0.13032||712   偷香高手类似的
      - 绝世兵王五十二策  绝世兵王
    - 包含关系
      - 包含关系留下UV大的
  - 第三层是根据一些字面的意思：但是query1+query2的长度必须小于9，不做处理，错误率比较高
    - 字集合的jaccad系数和提取关键词的集合jaccad系数(关键词定义为***名词，动词，成语，关键词***集合中的jaccard系数)
      - **正确的**
         - 6s运行内存多大    苹果运行内存多大        0.750   0.750
         - dmi指标详解       dmi指标详解视频 0.778   0.778
         - 阿笠博士的幕后故事        阿笠博士幕后故事17
         - 穿越火线乔杉电影  穿越火线电影    0.750   0.750
         - 初中生综合素质评价        初中生综合素质评语 
         - 荣耀magic视频     荣耀magic       0.778   0.778
    
      - **错误的**      
         - 超级农场  超级农场主      0.800   0.800
         - 大明星的贴身护卫  大小姐的贴身护卫        0.750   0.750
         - 都市仙君  都市大仙君      0.800   0.800
   - 语义层面的去重，通过wordtovector训练term之间的关系，主要解决的问题是短文本，query1+query2的长度<9的词语，一些明显关联度比较高的

        - 羽衣传说||5||0.20555||1373--羽衣传说目录||5||0.20319||1715      0.816
        - 于成龙||5||0.10566||62266--于成龙电视剧||2||2||111943   0.780
        - 爱恨何欢||8||0.17406||44--爱恨何欢欣欣向荣||3||10||45   0.882
        - 冷酷总裁的一夜情人||5||0.10671||1920--总裁的囚宠情人||2||2||9933    0.832
        - 天才魔妃太难追||2||3||2706--天才魔妃我要了||5||0.10264||6309    0.799
        - 红色鞋子||8||0.08283||52--鞋子||3||3||223   0.779
        - 夜太黑||8||0.09022||182--夜太黑林忆莲||3||10||394   0.850
        - 冰火魔厨||3||3||8336--冰火魔厨漫画||8||0.21497||21585   0.866
        - 洪荒之证道不朽||8||0.09329||244--洪荒不朽||8||0.10211||3093 0.880
        - 星际全能女王||8||0.08964||14--星际女神攻略||3||3||1335  0.792
        - 洛天依||3||5||11415--洛天依吸毒||8||0.22113||45463  0.725
        - 捕鱼大师||5||0.23225||758--捕鱼大师破解版||2||2||854 
        - 蛇蛇大作战无敌版||8||0.10439||2642--贪吃蛇大作战||8||0.10919||35958 0.816



###排序阶段
----------------------------------------
        
 
排序阶段一般采用learning to rank,或者ctr预估的模型，这个后续再写，第一版的版本就是按照规则排序的。聚类之后打散的过程，按照常搜在前面的内容       
    
    


